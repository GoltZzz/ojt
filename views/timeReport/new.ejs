<%- layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/weeklyReportsNew.css" />

<div class="container mt-4">
	<h1 class="mb-4">Upload Time Report (Excel to PDF)</h1>
	<form
		action="/timereport/upload-xlsx"
		method="POST"
		enctype="multipart/form-data"
		class="validated-form needs-validation">
		<div class="card mb-4">
			<div class="card-header">
				<h5>Student Information</h5>
			</div>
			<div class="card-body">
				<div class="mb-3">
					<label for="studentName" class="form-label">Student Name</label>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-user"></i></span>
						<input
							type="text"
							class="form-control bg-light"
							id="studentName"
							name="studentName"
							value="<%= fullName %>"
							readonly />
					</div>
				</div>
				<div class="mb-3">
					<label for="internshipSite" class="form-label">Internship Site</label>
					<div class="input-group">
						<span class="input-group-text"
							><i class="fas fa-building"></i
						></span>
						<input
							type="text"
							class="form-control bg-light"
							id="internshipSite"
							name="internshipSite"
							value="<%= internshipSite %>"
							readonly />
					</div>
				</div>
				<div class="row">
					<div class="col-md-4 mb-3">
						<label class="form-label">Week Number</label>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-hashtag"></i
							></span>
							<input
								type="text"
								class="form-control"
								value="<%= currentWeek ? currentWeek.weekNumber : '' %>"
								readonly />
						</div>
					</div>
					<div class="col-md-4 mb-3">
						<label class="form-label">Week Start Date</label>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-calendar-alt"></i
							></span>
							<input
								type="text"
								class="form-control"
								value="<%= weekStartLocal %>"
								readonly />
						</div>
					</div>
					<div class="col-md-4 mb-3">
						<label class="form-label">Week End Date</label>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-calendar-alt"></i
							></span>
							<input
								type="text"
								class="form-control"
								value="<%= weekEndLocal %>"
								readonly />
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="mb-3">
			<label for="xlsxFile" class="form-label">Select Excel File (.xlsx)</label>
			<input
				type="file"
				class="form-control"
				id="xlsxFile"
				name="xlsxFile"
				accept=".xlsx"
				required />
		</div>
		<div class="text-center mt-4">
			<button type="submit" class="btn btn-primary">Upload & Convert</button>
			<a href="/timereport" class="btn btn-secondary ms-2">Cancel</a>
		</div>
	</form>
	<% if (typeof pdfFile !== 'undefined' && pdfFile) { %>
	<div class="mt-5">
		<h2>Converted PDF Preview</h2>
		<div class="mb-3">
			<a
				href="/pdfs/<%= pdfFile.filename %>"
				target="_blank"
				class="btn btn-primary"
				>Download PDF</a
			>
		</div>
		<iframe
			src="/pdfs/<%= pdfFile.filename %>"
			width="100%"
			height="600px"
			style="border: 1px solid #ccc"></iframe>
	</div>
	<% } %>
</div>

<script>
	// Form validation
	(function () {
		"use strict";
		const forms = document.querySelectorAll(".validated-form");
		Array.from(forms).forEach(function (form) {
			form.addEventListener(
				"submit",
				function (event) {
					if (!form.checkValidity()) {
						event.preventDefault();
						event.stopPropagation();
					}
					form.classList.add("was-validated");
				},
				false
			);
		});
	})();
</script>
