<%- layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/dashboard.css" />
<link rel="stylesheet" href="/css/profile.css" />

<div class="dashboard-container">
	<div class="welcome-section">
		<h1>My Profile</h1>
		<p>View and edit your profile information</p>
	</div>

	<div class="row">
		<% if (user.role === 'admin') { %>
		<!-- Admin Profile View -->
		<div class="col-lg-6 mx-auto">
			<div class="profile-card">
				<div class="profile-header admin-profile-header">
					<div class="profile-avatar">
						<i class="fas fa-user-shield"></i>
					</div>
					<h3 class="profile-name">
						<% let fullName = user.firstName; if (user.middleName &&
						user.middleName.length > 0) { const middleInitial =
						user.middleName.charAt(0).toUpperCase(); fullName += `
						${middleInitial}.`; } fullName += ` ${user.lastName}`; %> <%=
						fullName %>
					</h3>
					<span class="profile-username">@<%= user.username %></span>
					<span class="profile-role badge bg-danger"> Administrator </span>
				</div>
				<div class="profile-body">
					<div class="profile-info">
						<div class="info-item">
							<span class="info-label"
								><i class="fas fa-user me-2"></i>Username</span
							>
							<span class="info-value"><%= user.username %></span>
						</div>
						<div class="info-item">
							<span class="info-label"
								><i class="fas fa-id-card me-2"></i>Full Name</span
							>
							<span class="info-value"><%= fullName %></span>
						</div>
						<div class="info-item">
							<span class="info-label"
								><i class="fas fa-user-shield me-2"></i>Role</span
							>
							<span class="info-value">Administrator</span>
						</div>
					</div>
					<div class="admin-info mt-4 mb-4">
						<div class="admin-info-header">
							<i class="fas fa-shield-alt me-2"></i> Administrator Privileges
						</div>
						<ul class="admin-privileges-list">
							<li>
								<i class="fas fa-check-circle text-success me-2"></i> Manage
								user accounts
							</li>
							<li>
								<i class="fas fa-check-circle text-success me-2"></i>
								Approve/reject reports
							</li>
							<li>
								<i class="fas fa-check-circle text-success me-2"></i>
								Archive/unarchive reports
							</li>
							<li>
								<i class="fas fa-check-circle text-success me-2"></i> Access
								system statistics
							</li>
						</ul>
					</div>
					<div class="profile-actions">
						<a
							href="#editProfileModal"
							class="btn btn-primary w-100 mb-2"
							data-bs-toggle="modal">
							<i class="fas fa-edit me-2"></i>Edit Profile
						</a>
						<a
							href="/profile/change-password"
							class="btn btn-outline-secondary w-100">
							<i class="fas fa-key me-2"></i>Change Password
						</a>
					</div>
				</div>
			</div>
		</div>
		<% } else { %>
		<!-- Regular User Profile View -->
		<div class="col-lg-4 mb-4">
			<div class="profile-card">
				<div class="profile-header">
					<div class="profile-avatar">
						<i class="fas fa-user-circle"></i>
					</div>
					<h3 class="profile-name">
						<% let fullName = user.firstName; if (user.middleName &&
						user.middleName.length > 0) { const middleInitial =
						user.middleName.charAt(0).toUpperCase(); fullName += `
						${middleInitial}.`; } fullName += ` ${user.lastName}`; %> <%=
						fullName %>
					</h3>
					<span class="profile-username">@<%= user.username %></span>
					<span class="profile-role badge bg-primary"> <%= user.role %> </span>
				</div>
				<div class="profile-body">
					<div class="profile-info">
						<div class="info-item">
							<span class="info-label"
								><i class="fas fa-user me-2"></i>Username</span
							>
							<span class="info-value"><%= user.username %></span>
						</div>
						<div class="info-item">
							<span class="info-label"
								><i class="fas fa-id-card me-2"></i>Full Name</span
							>
							<span class="info-value"><%= fullName %></span>
						</div>
						<div class="info-item">
							<span class="info-label"
								><i class="fas fa-user-shield me-2"></i>Role</span
							>
							<span class="info-value"><%= user.role %></span>
						</div>
					</div>
					<div class="profile-actions mt-4">
						<a
							href="#editProfileModal"
							class="btn btn-primary w-100 mb-2"
							data-bs-toggle="modal">
							<i class="fas fa-edit me-2"></i>Edit Profile
						</a>
						<a
							href="/profile/change-password"
							class="btn btn-outline-secondary w-100">
							<i class="fas fa-key me-2"></i>Change Password
						</a>
					</div>
				</div>
			</div>
		</div>

		<div class="col-lg-8">
			<div class="dashboard-card">
				<h3><i class="fas fa-chart-line me-2"></i>Activity Summary</h3>
				<div class="activity-summary">
					<div class="row">
						<div class="col-md-4">
							<div class="activity-stat">
								<div class="stat-icon bg-primary">
									<i class="fas fa-file-alt"></i>
								</div>
								<div class="stat-info">
									<h4>Weekly Reports</h4>
									<span class="stat-count">0</span>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="activity-stat">
								<div class="stat-icon bg-success">
									<i class="fas fa-book"></i>
								</div>
								<div class="stat-info">
									<h4>Documentation</h4>
									<span class="stat-count">0</span>
								</div>
							</div>
						</div>
						<div class="col-md-4">
							<div class="activity-stat">
								<div class="stat-icon bg-info">
									<i class="fas fa-clock"></i>
								</div>
								<div class="stat-info">
									<h4>Time Reports</h4>
									<span class="stat-count">0</span>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<% } %>
	</div>
</div>

<!-- Edit Profile Modal -->
<div
	class="modal fade"
	id="editProfileModal"
	tabindex="-1"
	aria-labelledby="editProfileModalLabel"
	aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="editProfileModalLabel">Edit Profile</h5>
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form
					action="/profile"
					method="POST"
					class="needs-validation"
					novalidate>
					<div class="mb-3">
						<label for="firstName" class="form-label">First Name</label>
						<input
							type="text"
							class="form-control"
							id="firstName"
							name="firstName"
							value="<%= user.firstName %>"
							required />
						<div class="invalid-feedback">Please enter your first name</div>
					</div>
					<div class="mb-3">
						<label for="middleName" class="form-label">Middle Name</label>
						<input
							type="text"
							class="form-control"
							id="middleName"
							name="middleName"
							value="<%= user.middleName || '' %>" />
					</div>
					<div class="mb-3">
						<label for="lastName" class="form-label">Last Name</label>
						<input
							type="text"
							class="form-control"
							id="lastName"
							name="lastName"
							value="<%= user.lastName %>"
							required />
						<div class="invalid-feedback">Please enter your last name</div>
					</div>
					<div class="mb-3">
						<label for="username" class="form-label">Username</label>
						<input
							type="text"
							class="form-control"
							id="username"
							value="<%= user.username %>"
							disabled />
						<small class="text-muted">Username cannot be changed</small>
					</div>
					<div class="d-flex justify-content-end">
						<button
							type="button"
							class="btn btn-secondary me-2"
							data-bs-dismiss="modal">
							Cancel
						</button>
						<button type="submit" class="btn btn-primary">Save Changes</button>
					</div>
				</form>
			</div>
		</div>
	</div>
</div>

<script>
	// Form validation
	(function () {
		"use strict";

		// Fetch all forms we want to apply validation to
		const forms = document.querySelectorAll(".needs-validation");

		// Loop over them and prevent submission
		Array.from(forms).forEach((form) => {
			form.addEventListener(
				"submit",
				(event) => {
					if (!form.checkValidity()) {
						event.preventDefault();
						event.stopPropagation();
					}

					form.classList.add("was-validated");
				},
				false
			);
		});
	})();
</script>
