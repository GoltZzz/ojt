<%- layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/weeklyReportsNew.css" />

<div class="container mt-4">
	<h1 class="mb-4">Create Weekly Progress Report</h1>
	<form
		action="/weeklyprogress"
		method="POST"
		novalidate
		class="validated-form needs-validation">
		<!-- Student Information Section -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>Student Information</h5>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-6 mb-3">
						<label for="studentName" class="form-label"
							>Student Name
							<small class="text-muted"
								>(auto-filled from your profile)</small
							></label
						>
						<div class="input-group">
							<span class="input-group-text"><i class="fas fa-user"></i></span>
							<input
								type="text"
								class="form-control bg-light"
								id="studentName"
								name="studentName"
								value="<%= fullName %>"
								readonly />
						</div>
					</div>
					<div class="col-md-6 mb-3">
						<label for="internshipSite" class="form-label"
							>Internship Site</label
						>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-building"></i
							></span>
							<input
								type="text"
								class="form-control"
								id="internshipSite"
								name="internshipSite"
								required />
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Week Information Section -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>Week Information</h5>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-4 mb-3">
						<label for="weekNumber" class="form-label">Week Number</label>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-hashtag"></i
							></span>
							<input
								type="number"
								class="form-control"
								id="weekNumber"
								name="weekNumber"
								min="1"
								required />
						</div>
					</div>
					<div class="col-md-4 mb-3">
						<label for="weekStartDate" class="form-label"
							>Week Start Date</label
						>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-calendar-alt"></i
							></span>
							<input
								type="date"
								class="form-control"
								id="weekStartDate"
								name="weekStartDate"
								required />
						</div>
					</div>
					<div class="col-md-4 mb-3">
						<label for="weekEndDate" class="form-label">Week End Date</label>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-calendar-alt"></i
							></span>
							<input
								type="date"
								class="form-control"
								id="weekEndDate"
								name="weekEndDate"
								required />
						</div>
					</div>
				</div>
			</div>
		</div>

		<!-- Weekly Activities Section -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>Weekly Activities</h5>
			</div>
			<div class="card-body">
				<div class="mb-3">
					<label for="dutiesPerformed" class="form-label"
						>Duties Performed this week</label
					>
					<textarea
						class="form-control"
						id="dutiesPerformed"
						name="dutiesPerformed"
						rows="4"
						required></textarea>
				</div>
				<div class="mb-3">
					<label for="newTrainings" class="form-label"
						>What new training/s took place this week?</label
					>
					<textarea
						class="form-control"
						id="newTrainings"
						name="newTrainings"
						rows="4"
						required></textarea>
				</div>
			</div>
		</div>

		<!-- Accomplishments Section -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>Major Accomplishments</h5>
				<p class="text-muted mb-0">
					What were your major accomplishments based from the Proposed
					Activities in your Training Schedule Form?
				</p>
				<p class="text-muted">
					Provide a detailed description of the tasks involved in the
					accomplishment.
				</p>
			</div>
			<div class="card-body">
				<div id="accomplishmentsContainer">
					<div class="accomplishment-item mb-3 p-3 border rounded">
						<div class="mb-3">
							<label
								for="accomplishments[0][proposedActivity]"
								class="form-label"
								>PROPOSED ACTIVITY</label
							>
							<textarea
								class="form-control"
								id="accomplishments[0][proposedActivity]"
								name="accomplishments[0][proposedActivity]"
								rows="2"
								required></textarea>
						</div>
						<div class="mb-3">
							<label
								for="accomplishments[0][accomplishmentDetails]"
								class="form-label"
								>ACCOMPLISHMENTS</label
							>
							<textarea
								class="form-control"
								id="accomplishments[0][accomplishmentDetails]"
								name="accomplishments[0][accomplishmentDetails]"
								rows="3"
								required></textarea>
						</div>
					</div>
				</div>
				<button
					type="button"
					class="btn btn-outline-primary"
					id="addAccomplishment">
					<i class="fas fa-plus"></i> Add Another Accomplishment
				</button>
			</div>
		</div>

		<!-- Problems and Goals Section -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>Problems and Goals</h5>
			</div>
			<div class="card-body">
				<div class="mb-3">
					<label for="problemsEncountered" class="form-label"
						>What problems have you encountered this week?</label
					>
					<textarea
						class="form-control"
						id="problemsEncountered"
						name="problemsEncountered"
						rows="3"></textarea>
				</div>
				<div class="mb-3">
					<label for="problemSolutions" class="form-label"
						>How did you overcome or solve those problems?</label
					>
					<textarea
						class="form-control"
						id="problemSolutions"
						name="problemSolutions"
						rows="3"></textarea>
				</div>
				<div class="mb-3">
					<label for="goalsForNextWeek" class="form-label"
						>List one or two goals you have set for yourself next week</label
					>
					<textarea
						class="form-control"
						id="goalsForNextWeek"
						name="goalsForNextWeek"
						rows="3"
						required></textarea>
				</div>
			</div>
		</div>

		<!-- Supervisor Section -->
		<div class="card mb-4">
			<div class="card-header">
				<h5>Supervisor Information</h5>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-6 mb-3">
						<label for="supervisorName" class="form-label"
							>Supervisor Name</label
						>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-user-tie"></i
							></span>
							<input
								type="text"
								class="form-control"
								id="supervisorName"
								name="supervisorName"
								required />
						</div>
					</div>
					<div class="col-md-6 mb-3">
						<label for="supervisorRole" class="form-label"
							>Supervisor Role</label
						>
						<div class="input-group">
							<span class="input-group-text"
								><i class="fas fa-id-badge"></i
							></span>
							<input
								type="text"
								class="form-control"
								id="supervisorRole"
								name="supervisorRole"
								required />
						</div>
					</div>
				</div>
				<div class="mb-3">
					<p class="text-center font-italic">
						<strong>Note:</strong> This report will be submitted for review. The
						supervisor will sign it upon approval.
					</p>
				</div>
			</div>
		</div>

		<div class="d-grid gap-2 d-md-flex justify-content-md-end">
			<a href="/weeklyprogress" class="btn btn-secondary me-md-2">Cancel</a>
			<button type="submit" class="btn btn-primary">Submit Report</button>
		</div>
	</form>
</div>

<script>
	document.addEventListener("DOMContentLoaded", function () {
		// Add accomplishment button functionality
		let accomplishmentCount = 1;
		const addAccomplishmentBtn = document.getElementById("addAccomplishment");
		const accomplishmentsContainer = document.getElementById(
			"accomplishmentsContainer"
		);

		addAccomplishmentBtn.addEventListener("click", function () {
			const newAccomplishment = document.createElement("div");
			newAccomplishment.className =
				"accomplishment-item mb-3 p-3 border rounded";
			newAccomplishment.innerHTML = `
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h6 class="mb-0">Additional Accomplishment</h6>
                    <button type="button" class="btn btn-sm btn-outline-danger remove-accomplishment">
                        <i class="fas fa-times"></i> Remove
                    </button>
                </div>
                <div class="mb-3">
                    <label for="accomplishments[${accomplishmentCount}][proposedActivity]" class="form-label">PROPOSED ACTIVITY</label>
                    <textarea class="form-control" id="accomplishments[${accomplishmentCount}][proposedActivity]" name="accomplishments[${accomplishmentCount}][proposedActivity]" rows="2" required></textarea>
                </div>
                <div class="mb-3">
                    <label for="accomplishments[${accomplishmentCount}][accomplishmentDetails]" class="form-label">ACCOMPLISHMENTS</label>
                    <textarea class="form-control" id="accomplishments[${accomplishmentCount}][accomplishmentDetails]" name="accomplishments[${accomplishmentCount}][accomplishmentDetails]" rows="3" required></textarea>
                </div>
            `;

			accomplishmentsContainer.appendChild(newAccomplishment);
			accomplishmentCount++;

			// Add event listener to the remove button
			const removeButtons = document.querySelectorAll(".remove-accomplishment");
			removeButtons.forEach((button) => {
				button.addEventListener("click", function () {
					this.closest(".accomplishment-item").remove();
				});
			});
		});

		// Date validation - ensure end date is after start date
		const weekStartDate = document.getElementById("weekStartDate");
		const weekEndDate = document.getElementById("weekEndDate");

		weekStartDate.addEventListener("change", function () {
			weekEndDate.min = this.value;
		});

		weekEndDate.addEventListener("change", function () {
			if (weekStartDate.value && this.value < weekStartDate.value) {
				alert("End date cannot be before start date");
				this.value = "";
			}
		});
	});
</script>
