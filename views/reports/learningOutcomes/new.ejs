<%- layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/flashMsg.css" />
<link rel="stylesheet" href="/css/sidebar.css" />
<link rel="stylesheet" href="/css/footer.css" />
<link rel="stylesheet" href="/css/breadcrumbs.css" />
<link rel="stylesheet" href="/css/weeklyReportsNew.css" />
<style>
	.entry-card {
		border: 1px solid #e0e0e0;
		border-radius: 8px;
		padding: 15px;
		margin-bottom: 15px;
		position: relative;
		background-color: #f9f9f9;
	}
	.remove-entry {
		position: absolute;
		top: 10px;
		right: 10px;
		cursor: pointer;
		color: #dc3545;
		font-size: 1.2rem;
	}
	.add-entry-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		gap: 8px;
		margin-bottom: 20px;
	}
	.date-display {
		font-weight: bold;
		margin-bottom: 10px;
		color: #2193b0;
	}
</style>

<div class="container mt-4">
	<h1 class="mb-4">Create New Learning Outcomes</h1>
	<form
		action="/learningoutcomes"
		method="POST"
		novalidate
		class="validated-form needs-validation"
		id="learningOutcomeForm">
		<div class="card mb-4">
			<div class="card-header">
				<h5>Student Information</h5>
			</div>
			<div class="card-body">
				<div class="mb-3">
					<label for="studentName" class="form-label"
						>Student Name
						<small class="text-muted"
							>(auto-filled from your profile)</small
						></label
					>
					<div class="input-group">
						<span class="input-group-text"><i class="fas fa-user"></i></span>
						<input
							type="text"
							class="form-control bg-light"
							id="studentName"
							name="learningOutcome[studentName]"
							value="<%= fullName %>"
							readonly
							required />
						<span
							class="input-group-text"
							data-bs-toggle="tooltip"
							title="This field is automatically filled with your full name and cannot be changed">
							<i class="fas fa-lock"></i>
						</span>
					</div>
					<small class="form-text text-muted"
						>This field is automatically filled with your full name and cannot
						be changed.</small
					>
				</div>
			</div>
		</div>

		<div class="card mb-4">
			<div
				class="card-header d-flex justify-content-between align-items-center">
				<h5>Learning Outcomes</h5>
				<button type="button" class="btn btn-sm btn-primary" id="addEntryBtn">
					<i class="fas fa-plus"></i> Add Another Entry
				</button>
			</div>
			<div class="card-body" id="entriesContainer">
				<!-- Initial entry -->
				<div class="entry-card" id="entry-0">
					<div class="mb-3">
						<label for="date-0" class="form-label">Date</label>
						<input
							type="date"
							class="form-control date-input"
							id="date-0"
							name="learningOutcome[date][]"
							required />
						<div class="invalid-feedback">Please select a date.</div>
					</div>
					<div class="mb-3">
						<label for="activity-0" class="form-label">Activity</label>
						<textarea
							class="form-control"
							id="activity-0"
							name="learningOutcome[activity][]"
							rows="3"
							required
							placeholder="e.g., Created routes for user authentication"></textarea>
						<div class="invalid-feedback">Please describe the activity.</div>
					</div>
					<div class="mb-3">
						<label for="learningOutcome-0" class="form-label"
							>Learning Outcome</label
						>
						<textarea
							class="form-control"
							id="learningOutcome-0"
							name="learningOutcome[learningOutcome][]"
							rows="3"
							required
							placeholder="e.g., Improved understanding of frontend development and user experience design"></textarea>
						<div class="invalid-feedback">
							Please describe what you learned.
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="text-center">
			<button type="submit" class="btn btn-primary">
				Submit Learning Outcomes
			</button>
			<a href="/learningoutcomes" class="btn btn-secondary ms-2">Cancel</a>
		</div>
	</form>
</div>

<script>
	// Form validation
	(function () {
		"use strict";
		window.addEventListener(
			"load",
			function () {
				const forms = document.getElementsByClassName("needs-validation");
				Array.prototype.filter.call(forms, function (form) {
					form.addEventListener(
						"submit",
						function (event) {
							if (form.checkValidity() === false) {
								event.preventDefault();
								event.stopPropagation();
							}
							form.classList.add("was-validated");
						},
						false
					);
				});
			},
			false
		);
	})();

	document.addEventListener("DOMContentLoaded", function () {
		// Set default date to today for the first entry
		const today = new Date().toISOString().split("T")[0];
		document.getElementById("date-0").value = today;

		// Add entry functionality
		const addEntryBtn = document.getElementById("addEntryBtn");
		const entriesContainer = document.getElementById("entriesContainer");
		let entryCount = 1;

		addEntryBtn.addEventListener("click", function () {
			const newEntry = document.createElement("div");
			newEntry.className = "entry-card";
			newEntry.id = `entry-${entryCount}`;

			// Format today's date for display
			const dateObj = new Date();
			dateObj.setDate(dateObj.getDate() + entryCount); // Add days for subsequent entries
			const formattedDate = dateObj.toISOString().split("T")[0];

			newEntry.innerHTML = `
                <i class="fas fa-times-circle remove-entry" onclick="removeEntry(${entryCount})"></i>
                <div class="mb-3">
                    <label for="date-${entryCount}" class="form-label">Date</label>
                    <input type="date" class="form-control date-input" id="date-${entryCount}" name="learningOutcome[date][]" value="${formattedDate}" required>
                    <div class="invalid-feedback">
                        Please select a date.
                    </div>
                </div>
                <div class="mb-3">
                    <label for="activity-${entryCount}" class="form-label">Activity</label>
                    <textarea class="form-control" id="activity-${entryCount}" name="learningOutcome[activity][]" rows="3" required placeholder="e.g., Created routes for user authentication"></textarea>
                    <div class="invalid-feedback">
                        Please describe the activity.
                    </div>
                </div>
                <div class="mb-3">
                    <label for="learningOutcome-${entryCount}" class="form-label">Learning Outcome</label>
                    <textarea class="form-control" id="learningOutcome-${entryCount}" name="learningOutcome[learningOutcome][]" rows="3" required placeholder="e.g., Improved understanding of frontend development and user experience design"></textarea>
                    <div class="invalid-feedback">
                        Please describe what you learned.
                    </div>
                </div>
            `;

			entriesContainer.appendChild(newEntry);
			entryCount++;
		});

		// Make the remove entry function available globally
		window.removeEntry = function (id) {
			const entryToRemove = document.getElementById(`entry-${id}`);
			if (entryToRemove) {
				entryToRemove.remove();
			}
		};
	});
</script>
