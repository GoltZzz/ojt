<link rel="stylesheet" href="/css/sidebar.css" />
<div class="sidebar bg-light">
	<!-- Mobile navbar -->
	<nav class="mobile-nav navbar navbar-expand-lg d-lg-none">
		<div class="container-fluid">
			<a class="navbar-brand" href="/"
				><i class="fa-solid fa-file-alt"></i> OJT Report</a
			>

			<% if (currentUser && currentUser.role !== 'admin') { %>
			<!-- Mobile Notification Button -->
			<div class="dropdown d-inline-block me-2">
				<button
					class="btn btn-link notification-btn"
					type="button"
					id="mobile-notification-btn"
					data-bs-toggle="dropdown"
					aria-expanded="false">
					<i class="fas fa-bell"></i>
					<span
						class="notification-badge"
						id="mobile-notification-badge"
						style="display: none"
						>0</span
					>
				</button>
				<div
					class="dropdown-menu dropdown-menu-end notification-dropdown"
					aria-labelledby="mobile-notification-btn">
					<div class="notification-header">
						<h6 class="notification-title">Notifications</h6>
						<div class="notification-actions">
							<button class="btn btn-sm btn-link p-0" id="mobile-mark-all-read">
								Mark all as read
							</button>
						</div>
					</div>
					<ul class="notification-list" id="mobile-notification-list">
						<!-- Notifications will be loaded here -->
						<div class="notification-empty">
							<i class="fas fa-bell-slash mb-2"></i>
							<p>No new notifications</p>
						</div>
					</ul>
				</div>
			</div>
			<% } %>

			<button
				class="navbar-toggler"
				type="button"
				data-bs-toggle="collapse"
				data-bs-target="#mobileNav"
				aria-controls="mobileNav"
				aria-expanded="false"
				aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="mobileNav">
				<% if (currentUser) { %>
				<a href="/profile" class="text-decoration-none">
					<div class="mobile-user-profile mb-3">
						<div class="user-avatar">
							<% if (currentUser.profileImage && currentUser.profileImage.url) {
							%>
							<img
								src="<%= currentUser.profileImage.url %>"
								alt="<%= currentUser.username %>"
								class="user-avatar-img" />
							<% } else { %>
							<i class="fas fa-user-circle"></i>
							<% } %>
						</div>
						<div class="user-info">
							<h5 class="user-name">
								<% let mobileFullName = currentUser.firstName; if
								(currentUser.middleName && currentUser.middleName.length > 0) {
								const mobileMiddleInitial =
								currentUser.middleName.charAt(0).toUpperCase(); mobileFullName
								+= ` ${mobileMiddleInitial}.`; } mobileFullName += `
								${currentUser.lastName}`; %> <%= mobileFullName %>
							</h5>
							<span
								class="user-role badge <%= currentUser.role === 'admin' ? 'bg-danger' : 'bg-primary' %>">
								<%= currentUser.role %>
							</span>
						</div>
					</div>
				</a>
				<% } %>
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a href="/" class="nav-link"
							><i class="fa-solid fa-home"></i> Home</a
						>
					</li>
					<% if (currentUser) { %>
					<li class="nav-item">
						<a href="/profile" class="nav-link"
							><i class="fa-solid fa-user"></i> My Profile</a
						>
					</li>
					<% if (currentUser.role === 'admin') { %> <% } else { %>
					<li class="nav-item">
						<a href="/dashboard" class="nav-link"
							><i class="fa-solid fa-info-circle"></i> Dashboard</a
						>
					</li>
					<% } %> <% if (currentUser.role === 'admin') { %>
					<li class="nav-item">
						<a href="/admin" class="nav-link"
							><i class="fa-solid fa-user-shield"></i> Admin Panel
						</a>
					</li>
					<li class="nav-item">
						<a href="/admin/users" class="nav-link"
							><i class="fa-solid fa-users-cog"></i> User Management</a
						>
					</li>
					<% } %> <% if (currentUser.role === 'admin') { %>
					<li class="nav-item">
						<a href="/admin/pending-reports" class="nav-link">
							<i class="fa-solid fa-clipboard-check"></i> Pending Reports <% if
							(pendingReportsCount > 0) { %>
							<span class="badge bg-danger notification-badge"
								><%= pendingReportsCount %></span
							>
							<% } %>
						</a>
					</li>
					<li class="nav-item">
						<a href="/admin/reports" class="nav-link">
							<i class="fa-solid fa-clipboard-list"></i> All Reports
						</a>
					</li>
					<li class="nav-item">
						<a href="/admin/archived-reports" class="nav-link">
							<i class="fa-solid fa-archive"></i> Archived Reports
						</a>
					</li>
					<% } %> <% if (currentUser.role !== 'admin') { %>
					<li class="nav-item">
						<a href="/weeklyreport" class="nav-link"
							><i class="fa-solid fa-calendar-week"></i> Weekly Report</a
						>
					</li>

					<li class="nav-item">
						<a href="/weeklyprogress" class="nav-link"
							><i class="fa-solid fa-chart-line"></i> Weekly Progress</a
						>
					</li>

					<li class="nav-item">
						<a href="/trainingschedule" class="nav-link"
							><i class="fa-solid fa-calendar-alt"></i> Training Schedule</a
						>
					</li>

					<li class="nav-item">
						<a href="/learningoutcomes" class="nav-link"
							><i class="fa-solid fa-graduation-cap"></i> Learning Outcomes</a
						>
					</li>

					<li class="nav-item">
						<a href="/dailyattendance" class="nav-link"
							><i class="fa-solid fa-clipboard-check"></i> Daily Attendance</a
						>
					</li>

					<li class="nav-item">
						<a href="/documentation" class="nav-link"
							><i class="fa-solid fa-file-alt"></i> Documentation</a
						>
					</li>
					<li class="nav-item">
						<a href="/timereport" class="nav-link"
							><i class="fa-solid fa-clock"></i> Time Report</a
						>
					</li>
					<% } %>
					<li class="nav-item">
						<a href="/logout" class="nav-link"
							><i class="fa-solid fa-right-from-bracket"></i> Logout</a
						>
					</li>
					<% } %>
				</ul>
			</div>
		</div>
	</nav>

	<!-- Desktop sidebar -->
	<div class="desktop-sidebar d-none d-lg-block p-3">
		<div class="d-flex justify-content-between align-items-center mb-3">
			<h2><i class="fa-solid fa-file-alt"></i> OJT Summary Report</h2>

			<% if (currentUser && currentUser.role !== 'admin') { %>
			<!-- Notification Dropdown -->
			<div class="dropdown">
				<button
					class="btn btn-link notification-btn"
					type="button"
					id="notification-btn"
					data-bs-toggle="dropdown"
					aria-expanded="false">
					<i class="fas fa-bell"></i>
					<span
						class="notification-badge"
						id="notification-badge"
						style="display: none"
						>0</span
					>
				</button>
				<div
					class="dropdown-menu dropdown-menu-end notification-dropdown"
					aria-labelledby="notification-btn">
					<div class="notification-header">
						<h6 class="notification-title">Notifications</h6>
						<div class="notification-actions">
							<button class="btn btn-sm btn-link p-0" id="mark-all-read">
								Mark all as read
							</button>
						</div>
					</div>
					<ul class="notification-list" id="notification-list">
						<!-- Notifications will be loaded here -->
						<div class="notification-empty">
							<i class="fas fa-bell-slash mb-2"></i>
							<p>No new notifications</p>
						</div>
					</ul>
				</div>
			</div>
			<% } %>
		</div>

		<% if (currentUser) { %>
		<a href="/profile" class="text-decoration-none">
			<div class="user-profile mb-3">
				<div class="user-avatar">
					<% if (currentUser.profileImage && currentUser.profileImage.url) { %>
					<img
						src="<%= currentUser.profileImage.url %>"
						alt="<%= currentUser.username %>"
						class="user-avatar-img" />
					<% } else { %>
					<i class="fas fa-user-circle"></i>
					<% } %>
				</div>
				<div class="user-info">
					<h5 class="user-name">
						<% let fullName = currentUser.firstName; if (currentUser.middleName
						&& currentUser.middleName.length > 0) { const middleInitial =
						currentUser.middleName.charAt(0).toUpperCase(); fullName += `
						${middleInitial}.`; } fullName += ` ${currentUser.lastName}`; %> <%=
						fullName %>
					</h5>
					<span
						class="user-role badge <%= currentUser.role === 'admin' ? 'bg-danger' : 'bg-primary' %>">
						<%= currentUser.role %>
					</span>
				</div>
			</div>
		</a>
		<% } %>

		<ul class="nav flex-column">
			<li class="nav-item">
				<a href="/" class="nav-link"><i class="fa-solid fa-home"></i> Home</a>
			</li>
			<% if (currentUser) { %>
			<li class="nav-item">
				<a href="/profile" class="nav-link"
					><i class="fa-solid fa-user"></i> My Profile</a
				>
			</li>
			<% if (currentUser.role === 'admin') { %> <% } else { %>
			<li class="nav-item">
				<a href="/dashboard" class="nav-link"
					><i class="fa-solid fa-info-circle"></i> Dashboard</a
				>
			</li>
			<% } %> <% if (currentUser.role === 'admin') { %>
			<li class="nav-item">
				<a href="/admin" class="nav-link"
					><i class="fa-solid fa-user-shield"></i> Admin Panel
				</a>
			</li>
			<li class="nav-item">
				<a href="/admin/users" class="nav-link"
					><i class="fa-solid fa-users-cog"></i> User Management</a
				>
			</li>
			<% } %> <% if (currentUser.role === 'admin') { %>
			<li class="nav-item">
				<a href="/admin/pending-reports" class="nav-link">
					<i class="fa-solid fa-clipboard-check"></i> Pending Reports <% if
					(pendingReportsCount > 0) { %>
					<span class="badge bg-danger notification-badge"
						><%= pendingReportsCount %></span
					>
					<% } %>
				</a>
			</li>
			<li class="nav-item">
				<a href="/admin/reports" class="nav-link">
					<i class="fa-solid fa-clipboard-list"></i> All Reports
				</a>
			</li>
			<li class="nav-item">
				<a href="/admin/archived-reports" class="nav-link">
					<i class="fa-solid fa-archive"></i> Archived Reports
				</a>
			</li>
			<% } %> <% if (currentUser.role !== 'admin') { %>
			<li class="nav-item">
				<a href="/weeklyreport" class="nav-link"
					><i class="fa-solid fa-calendar-week"></i> Weekly Report</a
				>
			</li>

			<li class="nav-item">
				<a href="/weeklyprogress" class="nav-link"
					><i class="fa-solid fa-chart-line"></i> Weekly Progress</a
				>
			</li>

			<li class="nav-item">
				<a href="/trainingschedule" class="nav-link"
					><i class="fa-solid fa-calendar-alt"></i> Training Schedule</a
				>
			</li>

			<li class="nav-item">
				<a href="/learningoutcomes" class="nav-link"
					><i class="fa-solid fa-graduation-cap"></i> Learning Outcomes</a
				>
			</li>

			<li class="nav-item">
				<a href="/dailyattendance" class="nav-link"
					><i class="fa-solid fa-clipboard-check"></i> Daily Attendance</a
				>
			</li>

			<li class="nav-item">
				<a href="/documentation" class="nav-link"
					><i class="fa-solid fa-file-alt"></i> Documentation</a
				>
			</li>
			<li class="nav-item">
				<a href="/timereport" class="nav-link"
					><i class="fa-solid fa-clock"></i> Time Report</a
				>
			</li>
			<% } %>
			<li class="nav-item">
				<a href="/logout" class="nav-link"
					><i class="fa-solid fa-right-from-bracket"></i> Logout</a
				>
			</li>
			<% } %>
		</ul>
	</div>
</div>
