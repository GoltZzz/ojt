<%- layout('layouts/boilerplate') %>
<link rel="stylesheet" href="/css/dashboard.css" />

<div class="dashboard-container">
	<div class="welcome-section">
		<h1>Pending Reports</h1>
		<p>Monitor and manage pending reports</p>
	</div>

	<div class="dashboard-grid">
		<div class="dashboard-card full-width">
			<div
				class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
				<h1 class="h2">Pending Reports</h1>
			</div>

			<!-- Tabs for different report types -->
			<ul class="nav nav-tabs mb-4" id="reportTabs" role="tablist">
				<li class="nav-item" role="presentation">
					<button
						class="nav-link active"
						id="weekly-tab"
						data-bs-toggle="tab"
						data-bs-target="#weekly"
						type="button"
						role="tab"
						aria-controls="weekly"
						aria-selected="true">
						Weekly Reports <% if (weeklyProgressReports.length > 0) { %>
						<span class="badge bg-danger ms-1"
							><%= weeklyProgressReports.length %></span
						>
						<% } %>
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button
						class="nav-link"
						id="training-tab"
						data-bs-toggle="tab"
						data-bs-target="#training"
						type="button"
						role="tab"
						aria-controls="training"
						aria-selected="false">
						Training Schedules <% if (trainingSchedules.length > 0) { %>
						<span class="badge bg-danger ms-1"
							><%= trainingSchedules.length %></span
						>
						<% } %>
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button
						class="nav-link"
						id="learning-tab"
						data-bs-toggle="tab"
						data-bs-target="#learning"
						type="button"
						role="tab"
						aria-controls="learning"
						aria-selected="false">
						Learning Outcomes <% if (learningOutcomes.length > 0) { %>
						<span class="badge bg-danger ms-1"
							><%= learningOutcomes.length %></span
						>
						<% } %>
					</button>
				</li>
				<li class="nav-item" role="presentation">
					<button
						class="nav-link"
						id="attendance-tab"
						data-bs-toggle="tab"
						data-bs-target="#attendance"
						type="button"
						role="tab"
						aria-controls="attendance"
						aria-selected="false">
						Daily Attendance <% if (dailyAttendances.length > 0) { %>
						<span class="badge bg-danger ms-1"
							><%= dailyAttendances.length %></span
						>
						<% } %>
					</button>
				</li>
			</ul>

			<!-- Tab content -->
			<div class="tab-content" id="reportTabsContent">
				<!-- Weekly Progress Reports Tab -->
				<div
					class="tab-pane fade show active"
					id="weekly"
					role="tabpanel"
					aria-labelledby="weekly-tab">
					<div class="card">
						<div class="card-header bg-light">
							<h5 class="mb-0">Pending Weekly Progress Reports</h5>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-hover mb-0">
									<thead class="table-light">
										<tr>
											<th>Student Name</th>
											<th>Internship Site</th>
											<th>Week Period</th>
											<th>Date Submitted</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										<% if (weeklyProgressReports.length === 0) { %>
										<tr>
											<td colspan="5" class="text-center py-4">
												<div class="alert alert-info mb-0">
													<i class="fas fa-info-circle me-2"></i>
													No pending weekly progress reports found.
												</div>
											</td>
										</tr>
										<% } else { %> <% weeklyProgressReports.forEach(report => {
										%>
										<tr>
											<td>
												<%= report.authorFullName || report.studentName %>
											</td>
											<td><%= report.internshipSite %></td>
											<td>
												<%= new Date(report.weekStartDate).toLocaleDateString()
												%> - <%= new
												Date(report.weekEndDate).toLocaleDateString() %>
											</td>
											<td>
												<%= new Date(report.dateSubmitted).toLocaleDateString()
												%>
											</td>
											<td>
												<a
													href="/weeklyprogress/<%= report._id %>"
													class="btn btn-sm btn-info"
													target="_blank">
													<i class="fas fa-eye"></i> View
												</a>
												<button
													class="btn btn-sm btn-success"
													data-bs-toggle="modal"
													data-bs-target="#approveModal-weeklyprogress-<%= report._id %>">
													<i class="fas fa-check"></i> Approve
												</button>
												<button
													class="btn btn-sm btn-danger"
													data-bs-toggle="modal"
													data-bs-target="#rejectModal-weeklyprogress-<%= report._id %>">
													<i class="fas fa-times"></i> Reject
												</button>
											</td>
										</tr>

										<!-- Approve Modal -->
										<div
											class="modal fade"
											id="approveModal-weeklyprogress-<%= report._id %>"
											tabindex="-1"
											aria-labelledby="approveModalLabel-<%= report._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="approveModalLabel-<%= report._id %>">
															Approve Weekly Progress Report
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/weeklyprogress/<%= report._id %>/approve"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to approve this weekly
																progress report?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-<%= report._id %>"
																	class="form-label"
																	>Comments (Optional)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-<%= report._id %>"
																	name="adminComments"
																	rows="3"></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-success">
																Approve
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>

										<!-- Reject Modal -->
										<div
											class="modal fade"
											id="rejectModal-weeklyprogress-<%= report._id %>"
											tabindex="-1"
											aria-labelledby="rejectModalLabel-<%= report._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="rejectModalLabel-<%= report._id %>">
															Reject Weekly Progress Report
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/weeklyprogress/<%= report._id %>/reject"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to reject this weekly
																progress report?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-reject-<%= report._id %>"
																	class="form-label"
																	>Reason for Rejection (Required)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-reject-<%= report._id %>"
																	name="adminComments"
																	rows="3"
																	required></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-danger">
																Reject
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>
										<% }) %> <% } %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Training Schedules Tab -->
				<div
					class="tab-pane fade"
					id="training"
					role="tabpanel"
					aria-labelledby="training-tab">
					<div class="card">
						<div class="card-header bg-light">
							<h5 class="mb-0">Pending Training Schedules</h5>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-hover mb-0">
									<thead class="table-light">
										<tr>
											<th>Student Name</th>
											<th>Internship Site</th>
											<th>Training Period</th>
											<th>Date Submitted</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										<% if (trainingSchedules.length === 0) { %>
										<tr>
											<td colspan="5" class="text-center py-4">
												<div class="alert alert-info mb-0">
													<i class="fas fa-info-circle me-2"></i>
													No pending training schedules found.
												</div>
											</td>
										</tr>
										<% } else { %> <% trainingSchedules.forEach(schedule => { %>
										<tr>
											<td>
												<%= schedule.authorFullName || schedule.studentName %>
											</td>
											<td><%= schedule.internshipSite %></td>
											<td>
												<%= new Date(schedule.startDate).toLocaleDateString() %>
												- <%= new Date(schedule.endDate).toLocaleDateString() %>
											</td>
											<td>
												<%= new
												Date(schedule.dateSubmitted).toLocaleDateString() %>
											</td>
											<td>
												<a
													href="/trainingschedule/<%= schedule._id %>"
													class="btn btn-sm btn-info"
													target="_blank">
													<i class="fas fa-eye"></i> View
												</a>
												<button
													class="btn btn-sm btn-success"
													data-bs-toggle="modal"
													data-bs-target="#approveModal-trainingschedule-<%= schedule._id %>">
													<i class="fas fa-check"></i> Approve
												</button>
												<button
													class="btn btn-sm btn-danger"
													data-bs-toggle="modal"
													data-bs-target="#rejectModal-trainingschedule-<%= schedule._id %>">
													<i class="fas fa-times"></i> Reject
												</button>
											</td>
										</tr>

										<!-- Approve Modal -->
										<div
											class="modal fade"
											id="approveModal-trainingschedule-<%= schedule._id %>"
											tabindex="-1"
											aria-labelledby="approveModalLabel-<%= schedule._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="approveModalLabel-<%= schedule._id %>">
															Approve Training Schedule
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/trainingschedule/<%= schedule._id %>/approve"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to approve this training
																schedule?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-<%= schedule._id %>"
																	class="form-label"
																	>Comments (Optional)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-<%= schedule._id %>"
																	name="adminComments"
																	rows="3"></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-success">
																Approve
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>

										<!-- Reject Modal -->
										<div
											class="modal fade"
											id="rejectModal-trainingschedule-<%= schedule._id %>"
											tabindex="-1"
											aria-labelledby="rejectModalLabel-<%= schedule._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="rejectModalLabel-<%= schedule._id %>">
															Reject Training Schedule
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/trainingschedule/<%= schedule._id %>/reject"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to reject this training
																schedule?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-reject-<%= schedule._id %>"
																	class="form-label"
																	>Reason for Rejection (Required)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-reject-<%= schedule._id %>"
																	name="adminComments"
																	rows="3"
																	required></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-danger">
																Reject
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>
										<% }) %> <% } %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Learning Outcomes Tab -->
				<div
					class="tab-pane fade"
					id="learning"
					role="tabpanel"
					aria-labelledby="learning-tab">
					<div class="card">
						<div class="card-header bg-light">
							<h5 class="mb-0">Pending Learning Outcomes</h5>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-hover mb-0">
									<thead class="table-light">
										<tr>
											<th>Student Name</th>
											<th>Internship Site</th>
											<th>Title</th>
											<th>Date Submitted</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										<% if (learningOutcomes.length === 0) { %>
										<tr>
											<td colspan="5" class="text-center py-4">
												<div class="alert alert-info mb-0">
													<i class="fas fa-info-circle me-2"></i>
													No pending learning outcomes found.
												</div>
											</td>
										</tr>
										<% } else { %> <% learningOutcomes.forEach(outcome => { %>
										<tr>
											<td>
												<%= outcome.authorFullName || outcome.studentName %>
											</td>
											<td><%= outcome.internshipSite %></td>
											<td><%= outcome.title %></td>
											<td>
												<%= new Date(outcome.dateSubmitted).toLocaleDateString()
												%>
											</td>
											<td>
												<a
													href="/learningoutcomes/<%= outcome._id %>"
													class="btn btn-sm btn-info"
													target="_blank">
													<i class="fas fa-eye"></i> View
												</a>
												<button
													class="btn btn-sm btn-success"
													data-bs-toggle="modal"
													data-bs-target="#approveModal-learningoutcome-<%= outcome._id %>">
													<i class="fas fa-check"></i> Approve
												</button>
												<button
													class="btn btn-sm btn-danger"
													data-bs-toggle="modal"
													data-bs-target="#rejectModal-learningoutcome-<%= outcome._id %>">
													<i class="fas fa-times"></i> Reject
												</button>
											</td>
										</tr>

										<!-- Approve Modal -->
										<div
											class="modal fade"
											id="approveModal-learningoutcome-<%= outcome._id %>"
											tabindex="-1"
											aria-labelledby="approveModalLabel-<%= outcome._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="approveModalLabel-<%= outcome._id %>">
															Approve Learning Outcome
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/learningoutcome/<%= outcome._id %>/approve"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to approve this learning
																outcome?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-<%= outcome._id %>"
																	class="form-label"
																	>Comments (Optional)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-<%= outcome._id %>"
																	name="adminComments"
																	rows="3"></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-success">
																Approve
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>

										<!-- Reject Modal -->
										<div
											class="modal fade"
											id="rejectModal-learningoutcome-<%= outcome._id %>"
											tabindex="-1"
											aria-labelledby="rejectModalLabel-<%= outcome._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="rejectModalLabel-<%= outcome._id %>">
															Reject Learning Outcome
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/learningoutcome/<%= outcome._id %>/reject"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to reject this learning
																outcome?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-reject-<%= outcome._id %>"
																	class="form-label"
																	>Reason for Rejection (Required)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-reject-<%= outcome._id %>"
																	name="adminComments"
																	rows="3"
																	required></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-danger">
																Reject
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>
										<% }) %> <% } %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>

				<!-- Daily Attendance Tab -->
				<div
					class="tab-pane fade"
					id="attendance"
					role="tabpanel"
					aria-labelledby="attendance-tab">
					<div class="card">
						<div class="card-header bg-light">
							<h5 class="mb-0">Pending Daily Attendance Records</h5>
						</div>
						<div class="card-body p-0">
							<div class="table-responsive">
								<table class="table table-hover mb-0">
									<thead class="table-light">
										<tr>
											<th>Student Name</th>
											<th>Internship Site</th>
											<th>Date</th>
											<th>Date Submitted</th>
											<th>Actions</th>
										</tr>
									</thead>
									<tbody>
										<% if (dailyAttendances.length === 0) { %>
										<tr>
											<td colspan="5" class="text-center py-4">
												<div class="alert alert-info mb-0">
													<i class="fas fa-info-circle me-2"></i>
													No pending daily attendance records found.
												</div>
											</td>
										</tr>
										<% } else { %> <% dailyAttendances.forEach(attendance => {
										%>
										<tr>
											<td>
												<%= attendance.authorFullName || attendance.studentName
												%>
											</td>
											<td><%= attendance.internshipSite %></td>
											<td>
												<%= new Date(attendance.date).toLocaleDateString() %>
											</td>
											<td>
												<%= new
												Date(attendance.dateSubmitted).toLocaleDateString() %>
											</td>
											<td>
												<a
													href="/dailyattendance/<%= attendance._id %>"
													class="btn btn-sm btn-info"
													target="_blank">
													<i class="fas fa-eye"></i> View
												</a>
												<button
													class="btn btn-sm btn-success"
													data-bs-toggle="modal"
													data-bs-target="#approveModal-dailyattendance-<%= attendance._id %>">
													<i class="fas fa-check"></i> Approve
												</button>
												<button
													class="btn btn-sm btn-danger"
													data-bs-toggle="modal"
													data-bs-target="#rejectModal-dailyattendance-<%= attendance._id %>">
													<i class="fas fa-times"></i> Reject
												</button>
											</td>
										</tr>

										<!-- Approve Modal -->
										<div
											class="modal fade"
											id="approveModal-dailyattendance-<%= attendance._id %>"
											tabindex="-1"
											aria-labelledby="approveModalLabel-<%= attendance._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="approveModalLabel-<%= attendance._id %>">
															Approve Daily Attendance
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/dailyattendance/<%= attendance._id %>/approve"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to approve this daily
																attendance record?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-<%= attendance._id %>"
																	class="form-label"
																	>Comments (Optional)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-<%= attendance._id %>"
																	name="adminComments"
																	rows="3"></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-success">
																Approve
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>

										<!-- Reject Modal -->
										<div
											class="modal fade"
											id="rejectModal-dailyattendance-<%= attendance._id %>"
											tabindex="-1"
											aria-labelledby="rejectModalLabel-<%= attendance._id %>"
											aria-hidden="true">
											<div class="modal-dialog">
												<div class="modal-content">
													<div class="modal-header">
														<h5
															class="modal-title"
															id="rejectModalLabel-<%= attendance._id %>">
															Reject Daily Attendance
														</h5>
														<button
															type="button"
															class="btn-close"
															data-bs-dismiss="modal"
															aria-label="Close"></button>
													</div>
													<form
														action="/admin/dailyattendance/<%= attendance._id %>/reject"
														method="POST">
														<div class="modal-body">
															<p>
																Are you sure you want to reject this daily
																attendance record?
															</p>
															<div class="mb-3">
																<label
																	for="adminComments-reject-<%= attendance._id %>"
																	class="form-label"
																	>Reason for Rejection (Required)</label
																>
																<textarea
																	class="form-control"
																	id="adminComments-reject-<%= attendance._id %>"
																	name="adminComments"
																	rows="3"
																	required></textarea>
															</div>
														</div>
														<div class="modal-footer">
															<button
																type="button"
																class="btn btn-secondary"
																data-bs-dismiss="modal">
																Cancel
															</button>
															<button type="submit" class="btn btn-danger">
																Reject
															</button>
														</div>
													</form>
												</div>
											</div>
										</div>
										<% }) %> <% } %>
									</tbody>
								</table>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
